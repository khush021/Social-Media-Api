"use strict";function _objectWithoutProperties(e,r){if(null==e)return{};var t,n,a=_objectWithoutPropertiesLoose(e,r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)t=s[n],0<=r.indexOf(t)||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}function _objectWithoutPropertiesLoose(e,r){if(null==e)return{};var t,n,a={},s=Object.keys(e);for(n=0;n<s.length;n++)t=s[n],0<=r.indexOf(t)||(a[t]=e[t]);return a}var User=require("../models/User"),router=require("express").Router(),bcrypt=require("bcrypt");router.put("/:id",function(r,t){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.body.userId!=r.params.id&&!r.body.isAdmin){e.next=26;break}if(r.body.password)return e.prev=2,e.next=5,regeneratorRuntime.awrap(bcrypt.genSalt(10));e.next=14;break;case 5:return n=e.sent,e.next=8,regeneratorRuntime.awrap(bcrypt.hash(r.body.password,n));case 8:r.body.password=e.sent,e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(2),e.abrupt("return",t.status(500).json(err));case 14:return e.prev=14,e.next=17,regeneratorRuntime.awrap(User.findByIdAndUpdate(r.params.id,{$set:r.body}));case 17:e.sent,t.status(200).json("Account has been updated."),e.next=24;break;case 21:return e.prev=21,e.t1=e.catch(14),e.abrupt("return",t.status(500).json(e.t1));case 24:e.next=27;break;case 26:return e.abrupt("return",t.status(403).json("You cannot update this account because you are not the admin"));case 27:case"end":return e.stop()}},null,null,[[2,11],[14,21]])}),router.delete("/:id",function(r,t){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.body.userId!=r.params.id&&!r.body.isAdmin){e.next=26;break}if(r.body.password)return e.prev=2,e.next=5,regeneratorRuntime.awrap(bcrypt.genSalt(10));e.next=14;break;case 5:return n=e.sent,e.next=8,regeneratorRuntime.awrap(bcrypt.hash(r.body.password,n));case 8:r.body.password=e.sent,e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(2),e.abrupt("return",t.status(500).json(err));case 14:return e.prev=14,e.next=17,regeneratorRuntime.awrap(User.findByIdAndDelete(r.params.id));case 17:e.sent,t.status(200).json("Account has been deleted successfully."),e.next=24;break;case 21:return e.prev=21,e.t1=e.catch(14),e.abrupt("return",t.status(500).json(e.t1));case 24:e.next=27;break;case 26:return e.abrupt("return",t.status(403).json("You cannot delete this account because you are not the admin"));case 27:case"end":return e.stop()}},null,null,[[2,11],[14,21]])}),router.get("/",function(r,t){var n,a,s,u,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.query.userId,a=r.query.username,e.prev=2,n)return e.next=6,regeneratorRuntime.awrap(User.findById(n));e.next=9;break;case 6:e.t0=e.sent,e.next=12;break;case 9:return e.next=11,regeneratorRuntime.awrap(User.findOne({username:a}));case 11:e.t0=e.sent;case 12:s=e.t0,u=s._doc,u.password,u.updatedAt,o=_objectWithoutProperties(u,["password","updatedAt"]),t.status(200).json(o),e.next=20;break;case 17:e.prev=17,e.t1=e.catch(2),t.status(500).json(e.t1);case 20:case"end":return e.stop()}},null,null,[[2,17]])}),router.get("/friends/:userId",function(r,t){var n,a,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(User.findById(r.params.userId));case 3:return n=e.sent,e.next=6,regeneratorRuntime.awrap(Promise.all(n.followings.map(function(e){return User.findById(e)})));case 6:a=e.sent,s=[],a.map(function(e){var r=e._id,t=e.username,n=e.profilePicture;s.push({_id:r,username:t,profilePicture:n})}),t.status(200).json(s),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),t.status(500).json(e.t0);case 15:case"end":return e.stop()}},null,null,[[0,12]])}),router.put("/:id/follow",function(r,t){var n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.body.userId!==r.params.id)return e.prev=1,e.next=4,regeneratorRuntime.awrap(User.findById(r.params.id));e.next=24;break;case 4:return n=e.sent,e.next=7,regeneratorRuntime.awrap(User.findById(r.body.userId));case 7:if(a=e.sent,n.followers.includes(r.body.userId)){e.next=16;break}return e.next=11,regeneratorRuntime.awrap(n.updateOne({$push:{followers:r.body.userId}}));case 11:return e.next=13,regeneratorRuntime.awrap(a.updateOne({$push:{followings:r.params.id}}));case 13:t.status(200).json("user has been followed"),e.next=17;break;case 16:t.status(403).json("you allready follow this user");case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(1),t.status(500).json(e.t0);case 22:e.next=25;break;case 24:t.status(403).json("you cant follow yourself");case 25:case"end":return e.stop()}},null,null,[[1,19]])}),router.put("/:id/unfollow",function(r,t){var n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.body.userId!==r.params.id)return e.prev=1,e.next=4,regeneratorRuntime.awrap(User.findById(r.params.id));e.next=24;break;case 4:return n=e.sent,e.next=7,regeneratorRuntime.awrap(User.findById(r.body.userId));case 7:if(a=e.sent,n.followers.includes(r.body.userId))return e.next=11,regeneratorRuntime.awrap(n.updateOne({$pull:{followers:r.body.userId}}));e.next=16;break;case 11:return e.next=13,regeneratorRuntime.awrap(a.updateOne({$pull:{followings:r.params.id}}));case 13:t.status(200).json("user has been unfollowed"),e.next=17;break;case 16:t.status(403).json("you dont follow this user");case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(1),t.status(500).json(e.t0);case 22:e.next=25;break;case 24:t.status(403).json("you cant unfollow yourself");case 25:case"end":return e.stop()}},null,null,[[1,19]])}),module.exports=router;
//# sourceMappingURL=users.min.js.map
